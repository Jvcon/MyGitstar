---
import allReposData from '../content/repos.json';
import allCollectionsData from '../content/collections.json';

const repoCounts = allReposData.reduce((acc, repo) => {
  acc[repo.list_name] = (acc[repo.list_name] || 0) + 1;
  return acc;
}, {});

const tabData = ['全部', ...Object.keys(repoCounts).sort()].map(name => ({
  name: name,
  count: name === '全部' ? allReposData.length : repoCounts[name]
}));
---

<div id="repo-manager-container" class="manager-grid">
  <div class="repo-display-section">
    <div id="repo-tabs" class="tabs"></div>
    <div id="repo-cards-container" class="cards-container"></div>
  </div>
  <div id="collection-list-section" class="collection-list-section">
    <div class="toolbar">
      <button id="export-btn" class="comic-button">导出 JSON</button>
    </div>
    <div class="collection-creator">
      <input type="text" id="new-collection-input" placeholder="输入名称后回车，创建新 Collection" />
    </div>
    <div id="collection-list-container" class="list-container"></div>
  </div>
</div>

<style is:global>
  /* 之前的 CSS 保持不变，只需确保以下样式存在 */
  .repo-card.is-unfavorited {
    opacity: 0.6;
    background-color: var(--color-gray-800); /* 使用比普通卡片稍亮的背景，以示区别 */
  }
  .repo-card.is-unfavorited:hover {
    opacity: 1;
  }
  .repo-collection {
    font-size: 0.8rem;
    color: var(--color-gray-400);
    margin-top: 0.5rem;
    margin-bottom: 0;
  }
  .card-actions {
    margin-top: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .target-collection-selector select {
    background-color: var(--color-gray-700);
    color: var(--color-gray-200);
    border: 1px solid var(--color-gray-500);
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
  }
  .card-buttons button {
    background: none;
    border: none;
    color: var(--color-gray-400);
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0.25rem;
    margin-left: 0.5rem;
  }
  .card-buttons button:hover {
    color: var(--color-accent-200);
  }
  .collection-item.drag-over {
    border-color: var(--color-accent-600);
    border-style: dashed;
    background-color: var(--color-accent-950);
  }
</style>

<script type="module" define:vars={{ allReposData, allCollectionsData, tabData }}>
  import { initApp } from '/src/components/manage/App.js';
  
  initApp({
    allRepos: allReposData,
    allCollections: allCollectionsData,
    tabData: tabData
  });
</script>
